{
	# use staging ca for testing:
	# acme_ca https://acme-staging-v02.api.letsencrypt.org/directory

	storage file_system /enc/containers/caddy/data
	persist_config off

	log default {
		output file /enc/containers/caddy/log.json
		# format console
	}
}

# Note: when adding a new site, remember to
# forward 80 and 443 to this server for certs

auth.mizuna.dev {
	reverse_proxy :9000
}

home.mizuna.dev {
	respond "TODO: show home"
}

recipes.mizuna.dev {
	# reverse_proxy :8150
	respond "TODO: recipes"
}

sync.mizuna.dev {
	reverse_proxy /outpost.goauthentik.io/* http://localhost:9000

	forward_auth http://localhost:9000 {
		uri /outpost.goauthentik.io/auth/caddy

		copy_headers X-Authentik-Username X-Authentik-Groups X-Authentik-Email X-Authentik-Name X-Authentik-Uid X-Authentik-Jwt X-Authentik-Meta-Jwks X-Authentik-Meta-Outpost X-Authentik-Meta-Provider X-Authentik-Meta-App X-Authentik-Meta-Version

		trusted_proxies private_ranges
	}

	reverse_proxy http://localhost:8384 {
		header_up Host {upstream_hostport}
	}
}
